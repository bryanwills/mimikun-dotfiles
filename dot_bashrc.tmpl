# All platform 共通
export EDITOR=nvim

# XDG Base Directory
export XDG_CONFIG_HOME="$HOME/.config"
export XDG_CACHE_HOME="$HOME/.cache"
export XDG_DATA_HOME="$HOME/.local/share"
export XDG_STATE_HOME="$HOME/.local/state"

{{ if (eq .chezmoi.hostname "azusa") }}
export GTK_IM_MODULE="fcitx"
export QT_IM_MODULE="fcitx"
export XMODIFIERS="@im=fcitx"
{{ end }}

{{ if eq .chezmoi.os "linux" }}
# Linuxのとき
case $- in
    *i*) ;;
      *) return;;
esac

HISTCONTROL=ignoreboth
shopt -s histappend
HISTSIZE=1000
HISTFILESIZE=2000
shopt -s checkwinsize
[ -x /usr/bin/lesspipe ] && eval "$(SHELL=/bin/sh lesspipe)"

if [ -z "${debian_chroot:-}" ] && [ -r /etc/debian_chroot ]; then
    debian_chroot=$(cat /etc/debian_chroot)
fi

case "$TERM" in
    xterm-color|*-256color) color_prompt=yes;;
esac

if [ -n "$force_color_prompt" ]; then
    if [ -x /usr/bin/tput ] && tput setaf 1 >&/dev/null; then
    color_prompt=yes
    else
    color_prompt=
    fi
fi

if [ "$color_prompt" = yes ]; then
    PS1='${debian_chroot:+($debian_chroot)}\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ '
else
    PS1='${debian_chroot:+($debian_chroot)}\u@\h:\w\$ '
fi
unset color_prompt force_color_prompt

case "$TERM" in
xterm*|rxvt*)
    PS1='\[\e]0;${debian_chroot:+($debian_chroot)}\u@\h: \w\a\]$PS1'
    ;;
*)
    ;;
esac

if [ -x /usr/bin/dircolors ]; then
    if test -r ~/.dircolors
    then
        eval "$(dircolors -b ~/.dircolors)"
    else
        eval "$(dircolors -b)"
    fi
    alias ls='ls --color=auto'
    alias grep='grep --color=auto'
    alias fgrep='fgrep --color=auto'
    alias egrep='egrep --color=auto'
fi

alias alert='notify-send --urgency=low -i "$([ $? = 0 ] && echo terminal || echo error)" "$(history|tail -n1|sed -e '\''s/^\s*[0-9]\+\s*//;s/[;&|]\s*alert$//'\'')"'

if [ -f ~/.bash_aliases ]; then
    . ~/.bash_aliases
fi

if ! shopt -oq posix; then
  if [ -f /usr/share/bash-completion/bash_completion ]; then
    . /usr/share/bash-completion/bash_completion
  elif [ -f /etc/bash_completion ]; then
    . /etc/bash_completion
  fi
fi
#--------------------------------------------------------------------------------------

# neovim
export NVIM_APPNAME=nvim

export NVIM_CONFIG="$XDG_CONFIG_HOME/$NVIM_APPNAME"
export NVIM_DATA="$XDG_DATA_HOME/$NVIM_APPNAME"
export NVIM_STATE="$XDG_STATE_HOME/$NVIM_APPNAME"
export NVIM_CACHE="$XDG_CACHE_HOME/$NVIM_APPNAME"

# chezmoi
export CHEZMOI_DIR="$XDG_DATA_HOME/chezmoi"

# asdf
if command -v asdf >/dev/null 2>&1; then
    . "$HOME"/.asdf/asdf.sh
    . "$HOME"/.asdf/completions/asdf.bash
fi

# 仕事PCでのみdockerd実行チェックをする
{{ if (eq .chezmoi.hostname "TanakaPC") }}
# Start Docker daemon automatically when logging in if not running.
RUNNING=$(pgrep -f dockerd)
if [ -z "$RUNNING" ]; then
    sudo dockerd > /dev/null 2>&1 &
    disown
fi
{{ end }}

# env-vars
{{ if (eq .chezmoi.hostname "TanakaPC") }}
export GITHUB_USERNAME="{{ (bitwardenFields "item" "0f17c992-d0fe-4f36-bde8-95d9e2de3a6d").github_username.value }}"
export WIN_HOME="{{ (bitwardenFields "item" "0f17c992-d0fe-4f36-bde8-95d9e2de3a6d").win_home_path.value }}"
export OBSIDIAN_VAULT_ROOT="{{ (bitwardenFields "item" "0f17c992-d0fe-4f36-bde8-95d9e2de3a6d").obsidian_vault_root_path.value }}"
{{ else if (eq .chezmoi.hostname "azusa") }}
export GITHUB_USERNAME="{{ (bitwardenFields "item" "ec557677-82d9-4a61-a4f6-aed300cfb34f").github_username.value }}"
export OBSIDIAN_VAULT_ROOT=""
{{ else }}
export GITHUB_USERNAME="{{ (bitwardenFields "item" "ec557677-82d9-4a61-a4f6-aed300cfb34f").github_username.value }}"
export WIN_HOME="{{ (bitwardenFields "item" "ec557677-82d9-4a61-a4f6-aed300cfb34f").win_home_path.value }}"
export OBSIDIAN_VAULT_ROOT="{{ (bitwardenFields "item" "ec557677-82d9-4a61-a4f6-aed300cfb34f").obsidian_vault_root_path.value }}"
{{ end }}

export WORKSPACE="$GHQ_ROOT/github.com/$GITHUB_USERNAME"

{{ if (ne .chezmoi.hostname "azusa") }}
export windl="$WIN_HOME/Downloads"
export WIN_DESKTOP="$WIN_HOME/Desktop"
export WIN_DOCUMENTS="$WIN_HOME/Documents"

export obsidian_vault_root_path="$WIN_DOCUMENTS/$OBSIDIAN_VAULT_ROOT"
export obsidian_vault_path=$obsidian_vault_root_path
export obsidian_dailynote_path=$obsidian_vault_path/001_DailyNotes
export obsidian=$obsidian_dailynote_path
{{ end }}

# zoxide
if command -v zoxide >/dev/null 2>&1; then
    eval "$(zoxide init bash)"
fi

# starship
export STARSHIP_CONFIG="$XDG_CONFIG_HOME/starship/starship.toml"
export STARSHIP_CACHE="$XDG_CONFIG_HOME/.config/starship/cache"

if command -v starship >/dev/null 2>&1; then
    eval "$(starship init bash)"
fi

# fly.io
export FLYCTL_INSTALL="$HOME/.fly"
export PATH="$FLYCTL_INSTALL/bin:$PATH"

# pnpm
export PNPM_HOME="$XDG_DATA_HOME/pnpm"
export PATH="$PNPM_HOME:$PATH"
PNPM_COMPLETE="$XDG_CONFIG_HOME/tabtab/bash/__tabtab.bash"
if test -f "$PNPM_COMPLETE"; then
    . "$PNPM_COMPLETE"
fi

# broot
if command -v broot >/dev/null 2>&1; then
    source "$XDG_CONFIG_HOME/broot/launcher/bash/br"
fi

# Rye
if command -v rye >/dev/null 2>&1; then
    source "$HOME/.rye/env"
fi

# Linuxbrew
if command -v brew >/dev/null 2>&1; then
    eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
fi

# walk
function lk {
    cd "$(walk "$@")"
}

# rtx
#export RTX_DATA_DIR=$HOME/.rtx
#export RTX_CACHE_DIR=$RTX_DATA_DIR/cache

# luarocks
export PATH="$HOME/.luarocks/bin:$PATH"
export LUA_PATH="/usr/local/share/lua/5.3/?.lua;/usr/local/share/lua/5.3/?/init.lua;/usr/local/lib/lua/5.3/?.lua;/usr/local/lib/lua/5.3/?/init.lua;./?.lua;./?/init.lua;$HOME/.luarocks/share/lua/5.3/?.lua;$HOME/.luarocks/share/lua/5.3/?/init.lua"
export LUA_CPATH="/usr/local/lib/lua/5.3/?.so;/usr/local/lib/lua/5.3/loadall.so;./?.so;$HOME/.luarocks/lib/lua/5.3/?.so"

# aqua
# The directory path where aqua install tools
# default (linux and macOS): ${XDG_DATA_HOME:-$HOME/.local/share}/aquaproj-aqua
# default (windows): ${HOME/AppData/Local}/aquaproj-aqua
export AQUA_ROOT_DIR="$XDG_DATA_HOME/aqua"
export AQUA_CONFIG_DIR="$XDG_CONFIG_HOME/aqua"
export AQUA_BIN="$AQUA_ROOT_DIR/bin"

export PATH="$AQUA_BIN:$PATH"

if command -v aqua >/dev/null 2>&1; then
    # Log level
    #set -x AQUA_LOG_LEVEL "info"
    # configuration file path
    export AQUA_CONFIG="$AQUA_CONFIG_DIR/aqua.yaml"
    # global configuration file paths separated by semicolon :
    export AQUA_GLOBAL_CONFIG="$AQUA_CONFIG"
    # policy file paths separated by semicolon :
    export AQUA_POLICY_CONFIG="$XDG_CONFIG_HOME/aqua/policy.yaml"
    # If true, Policy is disabled (aqua >= v2.1.0)
    # NOTE: It's just idiot to care about security.
    export AQUA_DISABLE_POLICY=true
    # If true, Lazy Install is disabled (aqua >= v2.9.0)
    #export AQUA_DISABLE_LAZY_INSTALL=true
    # The maximum number of packages which are installed in parallel at the same time
    #export AQUA_MAX_PARALLELISM=5
    # GITHUB_TOKEN: GitHub Access Token.
    # This is required to install private repository's package
    #export AQUA_GITHUB_TOKEN=""
    # Log color setting (always|auto|never)
    #export AQUA_LOG_COLOR="always"
    # The progress bar is disabled by default, but you can enable it by setting the environment variable AQUA_PROGRESS_BAR to true
    export AQUA_PROGRESS_BAR=true
    # Other
    #export AQUA_GOOS=""
    #export AQUA_GOARCH=""
    # AQUA_X_SYS_EXEC
    # https://aquaproj.github.io/docs/reference/execve-2/
    #export AQUA_X_SYS_EXEC=false
    # If true, aqua outputs additional information such as description and link #2027 #2062 (aqua >= v2.9.0)
    #export AQUA_GENERATE_WITH_DETAIL=false
fi

# inshellisense
#if test -f ~/.inshellisense/key-bindings.bash
#then
#    source ~/.inshellisense/key-bindings.bash
#fi

# sheldon
export SHELDON_CONFIG_DIR="$XDG_CONFIG_HOME/sheldon/bash"
export SHELDON_DATA_DIR="$XDG_DATA_HOME/sheldon/bash"

if command -v sheldon >/dev/null 2>&1; then
    eval "$(sheldon source)"
fi

# PHP composer
export COMPOSER_CONFIG_HOME="$XDG_CONFIG_HOME/composer"
export COMPOSER_BIN_DIR="$COMPOSER_CONFIG_HOME/vendor/bin"

export PATH="$COMPOSER_BIN_DIR:$PATH"

{{ else if eq .chezmoi.os "darwin" }}
# macOSのとき
{{ else if eq .chezmoi.os "windows" }}
# Windowsのとき
export GHQ_ROOT=~/ghq
export GHQ_SELECTOR=fzf
export TZ="Asia/Tokyo"

alias vim=nvim
alias patch="patch -p1 <"
{{ else }}
# その他OSのとき
{{ end }}
