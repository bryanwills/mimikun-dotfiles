# Global
set -x LANG en_US.UTF-8
set -x GHQ_ROOT $HOME/ghq
set -x GHQ_SELECTOR fzf
set -x PIPENV_VENV_IN_PROJECT 1
set -x TODAY (date +"%Y/%m/%d")
set -x TZ "Asia/Tokyo"

# Fish paths
set -x FISH_CONFIG_DIR $HOME/.config/fish
set -x FISH_COMPLETIONS_DIR $HOME/.config/fish/completions
set -x FISH_FUNCTIONS_DIR $HOME/.config/fish/functions
set -x FISH_CACHE_DIR $HOME/.cache/fish

set -x CONFIG_FISH $FISH_CONFIG_DIR/config.fish
set -x CACHE_CONFIG_FISH $FISH_CACHE_DIR/config.fish

{{ if (eq .chezmoi.hostname "TanakaPC") }}
set -x WORKSPACE {{ (bitwardenFields "item" "0f17c992-d0fe-4f36-bde8-95d9e2de3a6d").workspace_path.value }}
set -x WIN_HOME {{ (bitwardenFields "item" "0f17c992-d0fe-4f36-bde8-95d9e2de3a6d").win_home_path.value }}
set -x obsidian $WIN_HOME/{{ (bitwardenFields "item" "0f17c992-d0fe-4f36-bde8-95d9e2de3a6d").obsidian_dailynotes_path.value }}
{{ else }}
set -x WORKSPACE {{ (bitwardenFields "item" "ec557677-82d9-4a61-a4f6-aed300cfb34f").config_fish_path_workspace.value }}
set -x WIN_HOME {{ (bitwardenFields "item" "ec557677-82d9-4a61-a4f6-aed300cfb34f").config_fish_path_win_home.value }}
set -x obsidian $WIN_HOME/{{ (bitwardenFields "item" "ec557677-82d9-4a61-a4f6-aed300cfb34f").obsidian_dailynotes_path.value }}
{{ end }}
set -x windl $WIN_HOME/Downloads
set -x WIN_DESKTOP $WIN_HOME/Desktop
set -x WIN_DOCUMENTS $WIN_HOME/Documents
set -x obsidian_vault_path "$obsidian/../"

# aliases
alias rm "rm -i"
alias mkdir "mkdir -p"
alias untar "tar xvf"
alias rm gomi
alias patch "patch -p1 <"
alias imgcat "wezterm imgcat"

# abbrs
abbr -a f fuck
abbr -a pueued_enable "systemctl --user enable pueue"
abbr -a pueued_start "systemctl --user start pueue"
abbr -a pueued_restart "systemctl --user restart pueue"
abbr -a ccd "chezmoi cd"
abbr -a chd "chezmoi cd"
abbr -a chec "chezmoi cd"
abbr -a cap "chezmoi apply"
abbr -a chp "chezmoi apply"
abbr -a chep "chezmoi apply"
abbr -a pu pueue
abbr -a puc "pueue clean -s"
abbr -a pucf "pueue clean"
abbr -a puf "pueue follow"
abbr -a pul "pueue log"

# XDG Base Directory
set -x XDG_CONFIG_HOME $HOME/.config
set -x XDG_CACHE_HOME $HOME/.cache
set -x XDG_DATA_HOME $HOME/.local/share
set -x XDG_STATE_HOME $HOME/.local/state

set -x LOCALBIN $HOME/.local/bin

set -x PATH /usr/bin $PATH
set -x PATH /usr/local/bin $PATH
set -x PATH /usr/local/sbin $PATH
set -x PATH $HOME/go/bin $PATH
set -x PATH $HOME/.cargo/bin $PATH

set -x DENO_INSTALL $HOME/.deno
set -x PATH $DENO_INSTALL/bin $PATH

set -x STARSHIP_CONFIG $HOME/.config/starship/starship.toml
set -x STARSHIP_CACHE ~/.config/starship/cache

#Ubuntu
set -x PATH /bin $PATH
set -x PATH /usr/games $PATH
set -x PATH /usr/sbin $PATH
set -x PATH /usr/local/games $PATH
set -x PATH /sbin $PATH
set -x PATH /snap/bin $PATH
set -x PATH $HOME/.fzf/bin $PATH
set -x PATH $HOME/.local/bin/ $PATH
set -x PATH $HOME/.npm-global/bin $PATH
set -x PATH $HOME/.dotnet/tools/ $PATH
set -x PATH $HOME/.gem/ruby/2.7.0/bin/ $PATH
set -x PATH $HOME/depot_tools $PATH
set -x PATH /usr/local/go/bin/ $PATH

set -x EDITOR nvim
set -x NVIM_APPNAME nvim

set -x NVIM_CONFIG $XDG_CONFIG_HOME/$NVIM_APPNAME
set -x NVIM_CACHE $XDG_CACHE_HOME/$NVIM_APPNAME
set -x NVIM_DATA $XDG_DATA_HOME/$NVIM_APPNAME
set -x NVIM_STATE $XDG_STATE_HOME/$NVIM_APPNAME

alias pip "python3 -m pip"
alias pipx "python3 -m pipx"

abbr -a open wsl-open
abbr -a zel zellij
alias pueuexec "pueue add --"

# Bun
set -x BUN_INSTALL $HOME/.bun
set -x PATH $BUN_INSTALL/bin $PATH

# fly.io
set -x FLYCTL_INSTALL $HOME/.fly
set -x PATH $FLYCTL_INSTALL/bin $PATH

# pnpm
set -x PNPM_HOME $HOME/.local/share/pnpm
set -x PATH "$PNPM_HOME" $PATH

# work pc only tools?
{{ if (eq .chezmoi.hostname "TanakaPC") }}
# JVM path
set -x JAVA_HOME $HOME/.cache/coursier/arc/https/github.com/AdoptOpenJDK/openjdk8-binaries/releases/download/jdk8u292-b10/OpenJDK8U-jdk_x64_linux_hotspot_8u292b10.tar.gz/jdk8u292-b10
set -x PATH $HOME/.cache/coursier/arc/https/github.com/AdoptOpenJDK/openjdk8-binaries/releases/download/jdk8u292-b10/OpenJDK8U-jdk_x64_linux_hotspot_8u292b10.tar.gz/jdk8u292-b10/bin $PATH

# coursier path
set -x PATH $HOME/.local/share/coursier/bin $PATH
# windowsのpathとかぶる問題防止
alias cs $HOME/.local/share/coursier/bin/cs
{{ end }}

# cabal config
set -x PATH $HOME/.cabal/bin $PATH
set -x PATH $HOME/.ghcup/bin $PATH

# wsl2-ssh-agent
set -x SSH_AUTH_SOCK $HOME/.ssh/wsl2-ssh-agent.sock

# https://github.com/antfu/ni config
set -x NI_CONFIG_FILE $HOME/.config/ni/.nirc

# codon config
set -x PATH $HOME/.codon/bin $PATH

# ls alias
alias ls eza

# ls abbr
abbr -a ll "ls -l"
abbr -a la "ls -a"
abbr -a lla "ls -l -a"
abbr -a l1 "ls -1"
abbr -a ll1 "ls -l -1"
abbr -a lt "ls --tree"
abbr -a lta "ls --tree -a"
abbr -a llt "ls -l --tree"
abbr -a ll1 "ls -l -1"
abbr -a lt1 "ls --tree -1"
abbr -a lat "ls -a --tree"

# Rye
set -x PATH $HOME/.rye/shims $PATH

# rtx PATHs
set -x RTX_DATA_DIR $HOME/.rtx
set -x RTX_CACHE_DIR $RTX_DATA_DIR/cache

# luarocks
set -x PATH $HOME/.luarocks/bin $PATH

set -x LUA_PATH "/usr/local/share/lua/5.3/?.lua"
set -x LUA_PATH "/usr/local/share/lua/5.3/?/init.lua" $LUA_PATH
set -x LUA_PATH "/usr/local/lib/lua/5.3/?.lua" $LUA_PATH
set -x LUA_PATH "/usr/local/lib/lua/5.3/?/init.lua" $LUA_PATH
set -x LUA_PATH "./?.lua" $LUA_PATH
set -x LUA_PATH "./?/init.lua" $LUA_PATH
set -x LUA_PATH "$HOME/.luarocks/share/lua/5.3/?.lua" $LUA_PATH
set -x LUA_PATH "$HOME/.luarocks/share/lua/5.3/?/init.lua" $LUA_PATH

set -x LUA_CPATH "/usr/local/lib/lua/5.3/?.so"
set -x LUA_CPATH "/usr/local/lib/lua/5.3/loadall.so" $LUA_CPATH
set -x LUA_CPATH "./?.so" $LUA_CPATH
set -x LUA_CPATH "$HOME/.luarocks/lib/lua/5.3/?.so" $LUA_CPATH

# dotnet-core completions
complete -f -c dotnet -a "(dotnet complete)"

# asdf
set -x PATH $HOME/.asdf/bin $PATH
set -x PATH $HOME/.asdf/shims $PATH
set -x ASDF_DIR $HOME/.asdf
set -x ASDF_DATA_DIR $HOME/.asdf
set -x ASDF_CONFIG_FILE $HOME/.asdfrc

# vim
type -q asdf
if test $status -eq 0
    # alias
    alias paleovim $HOME/.asdf/shims/vim
    alias neovim $HOME/.asdf/shims/nvim
    # abbr
    abbr -a pvim paleovim
    abbr -a nvim neovim
    abbr -a vim nvim
    abbr -a vip "nvim --headless '+Lazy! sync' +qa"
end

# aqua
set -x AQUA_ROOT_DIR $HOME/.local/share/aquaproj-aqua
set -x PATH $AQUA_ROOT_DIR/bin $PATH

# wsl2-ssh-agent
wsl2-ssh-agent > /dev/null 2>&1
set -x SSH_AUTH_SOCK $HOME/.ssh/wsl2-ssh-agent.sock

# inshellisense
if test -f ~/.inshellisense/key-bindings.fish
    source ~/.inshellisense/key-bindings.fish
end
# cache
# thx: https://zenn.dev/ryoppippi/articles/de6c931cc1028f
if test $CONFIG_FISH -nt $CACHE_CONFIG_FISH
    mkdir -p $FISH_CACHE_DIR
    echo "" > $CACHE_CONFIG_FISH

    # asdf-direnv config
    echo "# cache asdf-direnv config" >> $CACHE_CONFIG_FISH
    asdf exec direnv hook fish >> $CACHE_CONFIG_FISH

    # Linuxbrew
    echo "# cache linuxbrew config" >> $CACHE_CONFIG_FISH
    /home/linuxbrew/.linuxbrew/bin/brew shellenv fish >> $CACHE_CONFIG_FISH

    # rtx config
    #echo "# cache rtx shell-integration script" >> $CACHE_CONFIG_FISH
    #rtx activate fish >> $CACHE_CONFIG_FISH

    # starship config
    echo "# cache starship config" >> $CACHE_CONFIG_FISH
    starship init fish --print-full-init >> $CACHE_CONFIG_FISH

    # navi
    echo "# cache navi config" >> $CACHE_CONFIG_FISH
    cat ~/.config/navi/navi_widget.fish >> $CACHE_CONFIG_FISH

    # pnpm
    echo "# cache pnpm tab completion" >> $CACHE_CONFIG_FISH
    cat ~/.config/tabtab/fish/pnpm.fish >> $CACHE_CONFIG_FISH

    # work pc only tools
    {{ if (eq .chezmoi.hostname "TanakaPC") }}
    echo "# work pc only tools config" >> $CACHE_CONFIG_FISH
    cat $HOME/.config/{{ (bitwardenFields "item" "0f17c992-d0fe-4f36-bde8-95d9e2de3a6d").source_work_pc_only_tool_fish_1.value }} >> $CACHE_CONFIG_FISH
    {{ end }}
end
source $CACHE_CONFIG_FISH
